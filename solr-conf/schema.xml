<?xml version="1.0" encoding="UTF-8"?>
<schema name="search-index" version="1.6">

  <uniqueKey>id</uniqueKey>

  <!-- define field types -->

    <!-- these seem vaguely important-->
      <fieldType name="_nest_path_" class="solr.NestPathField" maxCharsForDocValues="-1" omitNorms="true" omitTermFreqAndPositions="true" stored="false" multiValued="false"/>
      <fieldType name="ancestor_path" class="solr.TextField">
        <analyzer type="index">
          <tokenizer name="keyword"/>
        </analyzer>
        <analyzer type="query">
          <tokenizer name="pathHierarchy" delimiter="/"/>
        </analyzer>
      </fieldType>
      <fieldType name="descendent_path" class="solr.TextField">
        <analyzer type="index">
          <tokenizer name="pathHierarchy" delimiter="/"/>
        </analyzer>
        <analyzer type="query">
          <tokenizer name="keyword"/>
        </analyzer>
      </fieldType>

    <!-- utilities -->
      <fieldType name="ignored" class="solr.StrField" indexed="false" stored="false" multiValued="true"/>
      <fieldType name="random" class="solr.RandomSortField" indexed="true"/>
    
    <!-- solr complains if we don't have these -->
      <fieldType name="booleans" class="solr.BoolField" sortMissingLast="true" multiValued="true"/>
      <fieldType name="pdates" class="solr.DatePointField" docValues="true" multiValued="true"/>
      <fieldType name="plongs" class="solr.LongPointField" docValues="true" multiValued="true"/>
      <fieldType name="pdoubles" class="solr.DoublePointField" docValues="true" multiValued="true"/>

    <!-- here's the good stuff-->
      <fieldType name="binary" class="solr.BinaryField"/>
      <fieldType name="boolean" class="solr.BoolField" sortMissingLast="true"/>
      <fieldType name="string" class="solr.StrField" sortMissingLast="true" docValues="true"/>
      <fieldType name="pdouble" class="solr.DoublePointField" docValues="true"/>
      <fieldType name="pfloat" class="solr.FloatPointField" docValues="true"/>
      <fieldType name="pint" class="solr.IntPointField" docValues="true"/>
      <fieldType name="plong" class="solr.LongPointField" docValues="true"/>
      <fieldType name="text_general" class="solr.TextField" positionIncrementGap="100" multiValued="true">
        <analyzer type="index">
          <tokenizer name="standard"/>
          <filter name="stop" ignoreCase="true" words="stopwords.txt"/>
          <filter name="lowercase"/>
        </analyzer>
        <analyzer type="query">
          <tokenizer name="standard"/>
          <filter name="stop" ignoreCase="true" words="stopwords.txt"/>
          <filter name="synonymGraph" expand="true" ignoreCase="true" synonyms="synonyms.txt"/>
          <filter name="lowercase"/>
        </analyzer>
      </fieldType>

    <!-- here's the REALLY good stuff -->
      <fieldType name="text_en" class="solr.TextField" positionIncrementGap="100">
        <analyzer type="index">
          <tokenizer name="standard"/>
          <filter name="stop" ignoreCase="true" words="lang/stopwords_en.txt"/>
          <filter name="lowercase"/>
          <filter name="englishPossessive"/>
          <filter protected="protwords.txt" name="keywordMarker"/>
          <filter name="porterStem"/>
        </analyzer>
        <analyzer type="query">
          <tokenizer name="standard"/>
          <filter name="synonymGraph" expand="true" ignoreCase="true" synonyms="synonyms.txt"/>
          <filter name="stop" ignoreCase="true" words="lang/stopwords_en.txt"/>
          <filter name="lowercase"/>
          <filter name="englishPossessive"/>
          <filter protected="protwords.txt" name="keywordMarker"/>
          <filter name="porterStem"/>
        </analyzer>
      </fieldType>

  <!-- these seem vaguely important-->
    <field          name="_nest_path_"            type="_nest_path_" />
    <field          name="_root_"                 type="string"                   indexed="true"  stored="false" />
    <field          name="_version_"              type="plong"                    indexed="false" stored="false" />

  <!-- link entry fields-->
    <field          name="id"                     type="string"                   indexed="true"  stored="true"   uninvertible="false"    multiValued="false" required="true" />
    <field          name="url"                    type="string"                   indexed="false" stored="true"   uninvertible="false"    multiValued="false" required="true" />
    <field          name="title"                  type="text_general"             indexed="true"  stored="true"   uninvertible="false"    multiValued="false" required="true"     termPositions="true" termVectors="true" />
    <field          name="description"            type="text_general"             indexed="true"  stored="true"   uninvertible="false"    multiValued="false"                     termPositions="true" termVectors="true" />
    <field          name="content"                type="text_general"             indexed="true"  stored="true"   uninvertible="false"    multiValued="false" required="true"     termPositions="true" termVectors="true" />
    <field          name="submitter"              type="string"                   indexed="false" stored="true"   uninvertible="false"    multiValued="false" default="anonymous" />

    <field          name="_text_"                 type="text_general"             indexed="true"  stored="false"  uninvertible="false"    multiValued="true" />
    <copyField      source="title"                dest="_text_" />
    <copyField      source="description"          dest="_text_" />
    <copyField      source="content"              dest="_text_" />

  <!-- dynamic fields for future expansion -->
    <dynamicField   name="*_descendent_path"      type="descendent_path"          indexed="true"  stored="true"   uninvertible="false" />
    <dynamicField   name="*_ancestor_path"        type="ancestor_path"            indexed="true"  stored="true"   uninvertible="false" />

    <dynamicField   name="ignored_*"              type="ignored"                                                  uninvertible="false" />
    <dynamicField   name="random_*"               type="random"                                                   uninvertible="false" />

    <dynamicField   name="*_t_en"                 type="text_en"                  indexed="true"  stored="true"   uninvertible="false"    multiValued="false" />
    <dynamicField   name="*_t_s_en"               type="text_en"                  indexed="true"  stored="true"   uninvertible="false" />
    <dynamicField   name="*_t"                    type="text_general"             indexed="true"  stored="true"   uninvertible="false"    multiValued="false" />
    <dynamicField   name="*_t_s"                  type="text_general"             indexed="true"  stored="true"   uninvertible="false" />
    <dynamicField   name="*_s"                    type="string"                   indexed="true"  stored="true"   uninvertible="false"    multiValued="false" />
    <dynamicField   name="*_s_s"                  type="string"                   indexed="true"  stored="true"   uninvertible="false" />
    <dynamicField   name="*_b"                    type="boolean"                  indexed="true"  stored="true"   uninvertible="false"    multiValued="false" />
    <dynamicField   name="*_b_s"                  type="boolean"                  indexed="true"  stored="true"   uninvertible="false" />

</schema>
